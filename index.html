<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; overflow: hidden; cursor: none; margin: 0; padding: 0; }
        #video-container { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; background: #000; }
        video { width: 100%; height: 100%; max-height: 100vh; object-fit: contain; }
        
        /* Egyszerűsített UI a gyorsabb renderelésért */
        .osd-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 8rem; opacity: 0; transition: opacity 0.2s; pointer-events: none; z-index: 20; text-shadow: 0 0 10px #000; }
        .controls-bar { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); padding: 30px; opacity: 0; transition: opacity 0.3s; z-index: 10; }
        .visible { opacity: 1 !important; }
        .progress-bg { width: 100%; height: 10px; background: rgba(255,255,255,0.2); border-radius: 5px; margin-bottom: 10px; }
        .progress-fill { height: 100%; background: #e50914; width: 0%; border-radius: 5px; }
        
        /* Töltőképernyő */
        #loader { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 50; display: flex; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <!-- Azonnali videó elem (előre betöltve) -->
    <div id="video-container">
        <video id="player" preload="auto" autoplay playsinline webkit-playsinline>
            <!-- A forrást JS adja hozzá azonnal -->
        </video>
    </div>

    <!-- Egyszerűsített Töltő -->
    <div id="loader">
        <i class="fas fa-circle-notch fa-spin text-4xl text-gray-500"></i>
    </div>

    <!-- Kezelőszervek -->
    <div id="osd-play" class="osd-icon"><i class="fas fa-play"></i></div>
    <div id="osd-pause" class="osd-icon"><i class="fas fa-pause"></i></div>
    <div id="osd-fwd" class="osd-icon"><i class="fas fa-forward"></i></div>
    <div id="osd-rwd" class="osd-icon"><i class="fas fa-backward"></i></div>
    
    <div id="controls" class="controls-bar">
        <div class="progress-bg"><div id="p-fill" class="progress-fill"></div></div>
        <div class="flex justify-between font-bold text-xl">
            <span id="status">Lejátszás</span>
            <span id="time">00:00</span>
        </div>
    </div>

    <script>
        // --- AZONNALI LINK FELDOLGOZÁS ---
        // Ez a rész fut le legelőször, hogy a TV azonnal elkezdje tölteni az adatot
        const vid = document.getElementById('player');
        const loader = document.getElementById('loader');
        
        function getUrl() {
            const href = window.location.href;
            const idx = href.indexOf("?film=");
            return idx !== -1 ? href.substring(idx + 6) : null;
        }

        const url = getUrl();
        
        if (url) {
            vid.src = url;
            // Megpróbáljuk azonnal indítani
            const p = vid.play();
            if (p !== undefined) {
                p.then(() => loader.style.display = 'none')
                 .catch(() => {
                     console.log("Autoplay tiltva, várakozás gombra.");
                     document.getElementById('status').innerText = "Nyomd meg az OK gombot";
                     // Ha nem indul el auto, akkor is eltüntetjük a loadert, hogy lássa a fekete képernyőt
                     loader.style.display = 'none'; 
                 });
            }
        } else {
             // Ha nincs link, jelzünk
             document.getElementById('status').innerText = "HIBA: Nincs ?film= link";
             loader.style.display = 'none';
             document.getElementById('controls').classList.add('visible');
        }

        // --- VEZÉRLÉS ---
        const controls = document.getElementById('controls');
        const pFill = document.getElementById('p-fill');
        const timeDisplay = document.getElementById('time');
        let uiTimer;

        function showUI() {
            controls.classList.add('visible');
            clearTimeout(uiTimer);
            if (!vid.paused) {
                uiTimer = setTimeout(() => controls.classList.remove('visible'), 3000);
            }
        }

        function osd(id) {
            const el = document.getElementById(id);
            el.style.opacity = 1;
            setTimeout(() => el.style.opacity = 0, 800);
            showUI();
        }

        // Események
        vid.addEventListener('timeupdate', () => {
            if(vid.duration) {
                pFill.style.width = (vid.currentTime / vid.duration * 100) + "%";
                let m = Math.floor(vid.currentTime / 60);
                let s = Math.floor(vid.currentTime % 60);
                timeDisplay.innerText = `${m}:${s<10?'0':''}${s}`;
            }
        });

        vid.addEventListener('waiting', () => loader.style.display = 'flex');
        vid.addEventListener('playing', () => loader.style.display = 'none');

        // Gombok
        document.addEventListener('keydown', (e) => {
            showUI();
            switch(e.key) {
                case 'Enter': case ' ': 
                    if(vid.paused) { vid.play(); osd('osd-play'); } 
                    else { vid.pause(); osd('osd-pause'); }
                    break;
                case 'ArrowRight': vid.currentTime += 10; osd('osd-fwd'); break;
                case 'ArrowLeft': vid.currentTime -= 10; osd('osd-rwd'); break;
                case 'ArrowUp': vid.volume = Math.min(1, vid.volume + 0.1); break;
                case 'ArrowDown': vid.volume = Math.max(0, vid.volume - 0.1); break;
            }
        });
    </script>
</body>
</html>


